# Connection string
conn_string = f'DRIVER={driver};SERVER={server};DATABASE={database};UID={username};PWD={password}'

# Connect to the SQL database
conn = pyodbc.connect(conn_string)


# Create a cursor object using the connection
cursor = conn.cursor()

# Function to insert DataFrame into SQL table
def insert_into_table(df, table_name, conn):
    cursor = conn.cursor()

    # Preparing SQL query to insert data
    placeholders = ', '.join('?' * len(df.columns))
    columns = ', '.join(df.columns)
    sql = f"INSERT INTO {table_name} ({columns}) VALUES ({placeholders})"

    # Inserting each row
    for index, row in df.iterrows():
        cursor.execute(sql, tuple(row))

    conn.commit()
    cursor.close()

# Insert data into the 'test_template' table- change table name, df - final output table, table name- final_metric_output
insert_into_table(df, 'test_template', conn)

# Close the connection
conn.close()

print("Data inserted successfully.")
